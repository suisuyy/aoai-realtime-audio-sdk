var we=Object.defineProperty;var ke=(e,t,n)=>t in e?we(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var k=(e,t,n)=>ke(e,typeof t!="symbol"?t+"":t,n);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const s of o.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&r(s)}).observe(document,{childList:!0,subtree:!0});function n(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerPolicy&&(o.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?o.credentials="include":i.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(i){if(i.ep)return;i.ep=!0;const o=n(i);fetch(i.href,o)}})();function x(e,t,n,r){function i(o){return o instanceof n?o:new n(function(s){s(o)})}return new(n||(n=Promise))(function(o,s){function c(u){try{a(r.next(u))}catch(d){s(d)}}function l(u){try{a(r.throw(u))}catch(d){s(d)}}function a(u){u.done?o(u.value):i(u.value).then(c,l)}a((r=r.apply(e,[])).next())})}function _(e,t){var n={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},r,i,o,s=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return s.next=c(0),s.throw=c(1),s.return=c(2),typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function c(a){return function(u){return l([a,u])}}function l(a){if(r)throw new TypeError("Generator is already executing.");for(;s&&(s=0,a[0]&&(n=0)),n;)try{if(r=1,i&&(o=a[0]&2?i.return:a[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,a[1])).done)return o;switch(i=0,o&&(a=[a[0]&2,o.value]),a[0]){case 0:case 1:o=a;break;case 4:return n.label++,{value:a[1],done:!1};case 5:n.label++,i=a[1],a=[0];continue;case 7:a=n.ops.pop(),n.trys.pop();continue;default:if(o=n.trys,!(o=o.length>0&&o[o.length-1])&&(a[0]===6||a[0]===2)){n=0;continue}if(a[0]===3&&(!o||a[1]>o[0]&&a[1]<o[3])){n.label=a[1];break}if(a[0]===6&&n.label<o[1]){n.label=o[1],o=a;break}if(o&&n.label<o[2]){n.label=o[2],n.ops.push(a);break}o[2]&&n.ops.pop(),n.trys.pop();continue}a=t.call(e,n)}catch(u){a=[6,u],i=0}finally{r=o=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}}function Y(e){var t=typeof Symbol=="function"&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&typeof e.length=="number")return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function W(e,t){var n=typeof Symbol=="function"&&e[Symbol.iterator];if(!n)return e;var r=n.call(e),i,o=[],s;try{for(;(t===void 0||t-- >0)&&!(i=r.next()).done;)o.push(i.value)}catch(c){s={error:c}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(s)throw s.error}}return o}function L(e){return this instanceof L?(this.v=e,this):new L(e)}function Ae(e,t,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r=n.apply(e,t||[]),i,o=[];return i=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),c("next"),c("throw"),c("return",s),i[Symbol.asyncIterator]=function(){return this},i;function s(f){return function(m){return Promise.resolve(m).then(f,d)}}function c(f,m){r[f]&&(i[f]=function(S){return new Promise(function(z,be){o.push([f,S,z,be])>1||l(f,S)})},m&&(i[f]=m(i[f])))}function l(f,m){try{a(r[f](m))}catch(S){g(o[0][3],S)}}function a(f){f.value instanceof L?Promise.resolve(f.value.v).then(u,d):g(o[0][2],f)}function u(f){l("next",f)}function d(f){l("throw",f)}function g(f,m){f(m),o.shift(),o.length&&l(o[0][0],o[0][1])}}function _e(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t=e[Symbol.asyncIterator],n;return t?t.call(e):(e=typeof Y=="function"?Y(e):e[Symbol.iterator](),n={},r("next"),r("throw"),r("return"),n[Symbol.asyncIterator]=function(){return this},n);function r(o){n[o]=e[o]&&function(s){return new Promise(function(c,l){s=e[o](s),i(c,l,s.done,s.value)})}}function i(o,s,c,l){Promise.resolve(l).then(function(a){o({value:a,done:c})},s)}}var Te=function(e){return typeof e=="object"&&e!==null&&"type"in e},Ee=function(e){return Te(e)&&["error","session.created","session.updated","input_audio_buffer.committed","input_audio_buffer.cleared","input_audio_buffer.speech_started","input_audio_buffer.speech_stopped","conversation.item.created","conversation.item.truncated","conversation.item.deleted","conversation.item.input_audio_transcription.completed","conversation.item.input_audio_transcription.failed","response.created","response.done","response.output_item.added","response.output_item.done","response.content_part.added","response.content_part.done","response.text.delta","response.text.done","response.audio_transcript.delta","response.audio_transcript.done","response.audio.delta","response.audio.done","response.function_call_arguments.delta","response.function_call_arguments.done","rate_limits.updated"].includes(e.type)},qe=WebSocket,Ie=function(e,t){return e.readyState!==WebSocket.OPEN?Promise.reject(new Error("Socket is not open")):(e.send(t),Promise.resolve())},xe=function(e){return{success:!0,message:e}},j=function(e){return{success:!1,error:e}},Le=function(e){return e.success},Me=function(){function e(t,n){var r=this;this.closedPromise=void 0,this.messageQueue=[],this.receiverQueue=[],this.done=!1,this.validate=n.validate,this.serialize=n.serialize,this.connectedPromise=new Promise(function(i,o){return x(r,void 0,void 0,function(){var s,c,l,a,u=this;return _(this,function(d){switch(d.label){case 0:return t.policy!==void 0?[3,1]:(a=t,[3,3]);case 1:return[4,t.policy(t)];case 2:a=d.sent(),d.label=3;case 3:return s=a,c=s.uri,l=s.protocols,this.socket=new qe(c.toString(),l),this.socket.onopen=function(){u.socket.onmessage=u.getMessageHandler(),u.closedPromise=new Promise(function(g){u.socket.onclose=u.getClosedHandler(g)}),u.socket.onerror=u.handleError,i()},this.socket.onerror=function(g){u.error=g.error,o(g)},[2]}})})})}return e.prototype.handleError=function(t){for(this.error=t.error;this.receiverQueue.length>0;){var n=W(this.receiverQueue.shift(),2);n[0];var r=n[1];r(t.error)}},e.prototype.getClosedHandler=function(t){var n=this;return function(r){for(n.done=!0;n.receiverQueue.length>0;){var i=W(n.receiverQueue.shift(),2),o=i[0],s=i[1];n.error?s(n.error):o({value:void 0,done:!0})}t()}},e.prototype.getMessageHandler=function(){var t=this;return function(n){var r=t.validate(n);if(Le(r)){var i=r.message;if(t.receiverQueue.length>0){var o=W(t.receiverQueue.shift(),2),s=o[0];o[1],s({value:i,done:!1})}else t.messageQueue.push(i)}else t.error=r.error,t.socket.close(1e3,"Unexpected message received")}},e.prototype[Symbol.asyncIterator]=function(){var t=this;return{next:function(){if(t.error)return Promise.reject(t.error);if(t.done)return Promise.resolve({value:void 0,done:!0});if(t.messageQueue.length>0){var n=t.messageQueue.shift();return Promise.resolve({value:n,done:!1})}else return new Promise(function(r,i){t.receiverQueue.push([r,i])})}}},e.prototype.send=function(t){return x(this,void 0,void 0,function(){var n;return _(this,function(r){switch(r.label){case 0:return[4,this.connectedPromise];case 1:if(r.sent(),this.error)throw this.error;return n=this.serialize(t),[2,Ie(this.socket,n)]}})})},e.prototype.close=function(){return x(this,void 0,void 0,function(){return _(this,function(t){switch(t.label){case 0:return[4,this.connectedPromise];case 1:return t.sent(),this.done?[2]:(this.socket.close(),[4,this.closedPromise]);case 2:return t.sent(),[2]}})})},e}();function K(e){return typeof e=="object"&&e!==null&&"key"in e&&typeof e.key=="string"}function Ce(e){return typeof e=="object"&&e!==null&&"getToken"in e&&typeof e.getToken=="function"}var Oe=function(e){return K(e)||Ce(e)},Re=function(e){return typeof e=="object"&&e!==null&&"model"in e&&typeof e.model=="string"},Pe=function(e){return typeof e=="object"&&e!==null&&"deployment"in e&&typeof e.deployment=="string"},J=function(){function e(t,n,r){var i=this,o=function(){if(K(t)&&Re(n))return i.openAISettings(t,n);if(Oe(n)&&Pe(r))return i.azureOpenAISettings(t,n,r);throw new Error("Invalid combination of arguments to initialize the Realtime client")}();this.client=this.getWebsocket(o)}return e.prototype.azureOpenAISettings=function(t,n,r){var i=this,o=["https://cognitiveservices.azure.com/.default"];return this.requestId=crypto.randomUUID(),t.searchParams.set("api-version","2024-10-01-preview"),t.searchParams.set("x-ms-client-request-id",this.requestId),t.searchParams.set("deployment",r.deployment),t.pathname="openai/realtime",{uri:t,policy:function(s){return x(i,void 0,void 0,function(){var c;return _(this,function(l){switch(l.label){case 0:return K(n)?(s.uri.searchParams.set("api-key",n.key),[3,3]):[3,1];case 1:return[4,n.getToken(o)];case 2:c=l.sent(),s.uri.searchParams.set("Authorization","Bearer ".concat(c.token)),l.label=3;case 3:return[2,s]}})})}}},e.prototype.openAISettings=function(t,n){var r=new URL("wss://api.openai.com/v1/realtime");return r.searchParams.set("model",n.model),{uri:r,protocols:["realtime","openai-insecure-api-key.".concat(t.key),"openai-beta.realtime-v1"]}},e.prototype.getWebsocket=function(t){var n={validate:function(r){if(typeof r.data!="string")return j(new Error("Invalid message type"));try{var i=JSON.parse(r.data);return Ee(i)?xe(i):j(new Error("Invalid message type"))}catch{return j(new Error("Invalid JSON message"))}},serialize:function(r){return JSON.stringify(r)}};return new Me(t,n)},e.prototype.messages=function(){return Ae(this,arguments,function(){var n,r,i,o,s,c,l,a,u;return _(this,function(d){switch(d.label){case 0:d.trys.push([0,7,8,13]),n=!0,r=_e(this.client),d.label=1;case 1:return[4,L(r.next())];case 2:return i=d.sent(),c=i.done,!c?(u=i.value,n=!1,o=u,[4,L(o)]):[3,6];case 3:return[4,d.sent()];case 4:d.sent(),d.label=5;case 5:return n=!0,[3,1];case 6:return[3,13];case 7:return s=d.sent(),l={error:s},[3,13];case 8:return d.trys.push([8,,11,12]),!n&&!c&&(a=r.return)?[4,L(a.call(r))]:[3,10];case 9:d.sent(),d.label=10;case 10:return[3,12];case 11:if(l)throw l.error;return[7];case 12:return[7];case 13:return[2]}})})},e.prototype.send=function(t){return x(this,void 0,void 0,function(){return _(this,function(n){switch(n.label){case 0:return[4,this.client.send(t)];case 1:return n.sent(),[2]}})})},e.prototype.close=function(){return x(this,void 0,void 0,function(){return _(this,function(t){switch(t.label){case 0:return[4,this.client.close()];case 1:return t.sent(),[2]}})})},e}();function Ue(e){let t={type:"session.update",session:{voice:e.voice||"breeze",modalities:["audio","text"],temperature:Ne(),max_response_output_tokens:600,turn_detection:{type:"server_vad",threshold:.5,prefix_padding_ms:1e3,silence_duration_ms:2e3}}};const n=ue();return n&&(t.session.instructions=n),t}function ue(){const e=`you are powerful voice assistant, you can make long pleasant melody and sing various songs, you can make nice and real  and long sound effect.

you can generate long(more than 10s), continuous melodies or extend them.

you can imitate different people voice`,t=document.querySelector("#session-instructions"),n=(t==null?void 0:t.value.trim())||"";return n===""?(t&&(t.value=e),e):n}function Ne(){var e;return parseFloat(((e=document.querySelector("#temperature"))==null?void 0:e.value)||"0.6")}function C(){var e;return((e=document.querySelector("#azure-toggle"))==null?void 0:e.checked)||!1}function le(){var n;const e=(((n=document.querySelector("#endpoint"))==null?void 0:n.value)||"").trim(),t=document.querySelector("#azure-toggle");t&&(t.checked=e.indexOf("azure")>-1)}var w=(e=>(e[e.Working=0]="Working",e[e.ReadyToStart=1]="ReadyToStart",e[e.ReadyToStop=2]="ReadyToStop",e))(w||{});function E(e){const t=document.querySelector("#endpoint"),n=document.querySelector("#api-key"),r=document.querySelector("#deployment-or-model"),i=document.querySelector("#start-recording"),o=document.querySelector("#stop-recording"),s=document.querySelector("#session-instructions"),c=document.querySelector("#azure-toggle"),l=e!==1;[t,n,r,s,c].forEach(u=>{u&&(u.disabled=l,u.classList.toggle("input-disabled",l))}),i&&(i.disabled=e!==1,i.classList.toggle("btn-disabled",e!==1)),o&&(o.disabled=e!==2,o.classList.toggle("btn-disabled",e!==2))}function I(e=""){const t=document.querySelector("#received-text-container");if(t){let n=document.createElement("p");n.textContent=e,n.className="mb-2",t.appendChild(n),t.scrollTop=t.scrollHeight}}function Be(e){const t=document.querySelector("#received-text-container");if(t){let n=t.children;n.length==0&&I(),n[n.length-1].textContent+=e,t.scrollTop=t.scrollHeight}}class De{constructor(t){k(this,"onDataAvailable");k(this,"audioContext",null);k(this,"mediaStream",null);k(this,"mediaStreamSource",null);k(this,"workletNode",null);this.onDataAvailable=t}async start(t){try{this.audioContext=new AudioContext({sampleRate:24e3}),await this.audioContext.audioWorklet.addModule("./audio-worklet-processor.js"),this.mediaStream=t,this.mediaStreamSource=this.audioContext.createMediaStreamSource(this.mediaStream),this.workletNode=new AudioWorkletNode(this.audioContext,"audio-worklet-processor"),this.workletNode.port.onmessage=n=>{this.onDataAvailable(n.data.buffer)},this.mediaStreamSource.connect(this.workletNode),this.workletNode.connect(this.audioContext.destination)}catch{this.stop()}}stop(){this.mediaStream&&this.mediaStream.getTracks().forEach(t=>t.stop())}}class Fe{constructor(){k(this,"playbackNode",null)}async init(t){const n=new AudioContext({sampleRate:t});await n.audioWorklet.addModule("playback-worklet.js"),this.playbackNode=new AudioWorkletNode(n,"playback-worklet"),this.playbackNode.connect(n.destination)}play(t){this.playbackNode&&this.playbackNode.port.postMessage(t)}clear(){this.playbackNode&&this.playbackNode.port.postMessage(null)}}let U,M,Q=!1,y=new Uint8Array,T=[];function ze(e){const t=new Uint8Array(y.length+e.length);t.set(y),t.set(e,y.length),y=t}function We(e,t){const n=new Uint8Array(e);if(ze(n),y.length>=4800){const r=new Uint8Array(y.slice(0,4800));y=new Uint8Array(y.slice(4800));const i=String.fromCharCode(...r),o=btoa(i);Q&&(t(o),T.push(new Int16Array(r.buffer)))}}async function O(e,t){Q=!1,U&&U.stop(),M&&M.clear(),y=new Uint8Array,T=[],U=new De(n=>We(n,t)),M=new Fe,M.init(24e3).then(()=>{e&&navigator.mediaDevices.getUserMedia({audio:!0}).then(n=>{U.start(n),Q=!0})})}function je(e){M.play(e)}function de(e){const t=new Int16Array(e.reduce((o,s)=>o+s.length,0));let n=0;for(const o of e)t.set(o,n),n+=o.length;const r=new Float32Array(t.length);for(let o=0;o<t.length;o++)r[o]=t[o]/32768;const i=He(r,24e3);return new Blob([i],{type:"audio/wav"})}function H(e){const t=URL.createObjectURL(e),n=document.createElement("audio");return n.src=t,n.controls=!0,n}function He(e,t){const n=new ArrayBuffer(44+e.length*2),r=new DataView(n);return N(r,0,"RIFF"),r.setUint32(4,36+e.length*2,!0),N(r,8,"WAVE"),N(r,12,"fmt "),r.setUint32(16,16,!0),r.setUint16(20,1,!0),r.setUint16(22,1,!0),r.setUint32(24,t,!0),r.setUint32(28,t*2,!0),r.setUint16(32,2,!0),r.setUint16(34,16,!0),N(r,36,"data"),r.setUint32(40,e.length*2,!0),Ke(r,44,e),n}function N(e,t,n){for(let r=0;r<n.length;r++)e.setUint8(t+r,n.charCodeAt(r))}function Ke(e,t,n){for(let r=0;r<n.length;r++,t+=2){const i=Math.max(-1,Math.min(1,n[r]));e.setInt16(t,i<0?i*32768:i*32767,!0)}}function Qe(){if(T.length===0)return null;const e=new Int16Array(T.reduce((i,o)=>i+o.length,0));let t=0;for(const i of T)e.set(i,t),t+=i.length;const n=new Uint8Array(e.buffer),r=String.fromCharCode(...n);return btoa(r)}function Ve(){console.log("Clearing recorded audio chunks"),T=[],y=new Uint8Array}function $(){return de(T)}const fe="messageUI",me="endpoint",pe="apiKey",ye="deploymentOrModel",he="autoStopTime";function q(){const e=document.querySelector("#session-instructions"),t=document.querySelector("#endpoint"),n=document.querySelector("#api-key"),r=document.querySelector("#deployment-or-model"),i=document.querySelector("#auto-stop-time");e&&localStorage.setItem(fe,e.value),t&&localStorage.setItem(me,t.value),n&&localStorage.setItem(pe,n.value),r&&localStorage.setItem(ye,r.value),i&&localStorage.setItem(he,i.value)}function Ge(){const e=document.querySelector("#session-instructions"),t=document.querySelector("#endpoint"),n=document.querySelector("#api-key"),r=document.querySelector("#deployment-or-model"),i=document.querySelector("#auto-stop-time");e&&(e.value=localStorage.getItem(fe)||""),t&&(t.value=localStorage.getItem(me)||""),n&&(n.value=localStorage.getItem(pe)||""),r&&(r.value=localStorage.getItem(ye)||""),i&&(i.value=localStorage.getItem(he)||"30")}let v,A,h=null,D=0,b=null,p=!1,F=!1;function G(e){const t=document.querySelector("#received-text-container");t&&(e?t.classList.add("recording"):t.classList.remove("recording"))}function Ye(){const e=document.getElementById("theme-toggle"),t=document.documentElement;e==null||e.addEventListener("click",()=>{t.classList.toggle("dark"),localStorage.setItem("theme",t.classList.contains("dark")?"dark":"light")});const n=localStorage.getItem("theme");n==="dark"?t.classList.add("dark"):(n==="light"||!n)&&t.classList.remove("dark")}function Je(){const e=document.querySelectorAll(".tab-button"),t=document.querySelectorAll(".tab-content");e.forEach(n=>{n.addEventListener("click",()=>{var i;const r=n.getAttribute("data-tab");e.forEach(o=>o.classList.remove("active")),t.forEach(o=>o.classList.add("hidden")),n.classList.add("active"),(i=document.getElementById(`${r}-tab`))==null||i.classList.remove("hidden")})})}async function ve(e,t,n){var r;C()?v=new J(new URL(e),{key:t},{deployment:n}):v=new J({key:t},{model:n});try{console.log("sending session config");const i=(r=document.querySelector("#voice-select"))==null?void 0:r.value;await v.send(Ue({voice:i})),console.log("sent session config:",`voice: ${i}`)}catch(i){console.log(i),I("[Connection error]: Unable to send initial config message. Please check your endpoint and authentication details."),E(w.ReadyToStart);return}console.log("sent"),G(!0),await Promise.all([O(!0,R),Xe()]),Ze()}function R(e){v.send({type:"input_audio_buffer.append",audio:e})}function $e(e){v.send({type:"conversation.item.create",item:{type:"message",role:"user",content:[{type:"input_text",text:e}]}})}async function Xe(){var t,n,r,i,o;let e=[];for await(const s of v.messages()){let c=""+s.type;switch(s.type){case"session.created":E(w.ReadyToStop),I("<< Session Started >>"),I();break;case"response.audio_transcript.delta":Be(s.delta);break;case"response.audio.delta":const l=atob(s.delta),a=Uint8Array.from(l,m=>m.charCodeAt(0)),u=new Int16Array(a.buffer);e.push(u),je(u);break;case"response.created":console.log("response created"),e=[];break;case"input_audio_buffer.speech_started":I("<< Speech Started >>");let d=(t=document.querySelector("#received-text-container"))==null?void 0:t.children;d&&(A=d[d.length-1]),I();break;case"input_audio_buffer.committed":console.log("###### HandleRealtimeMessages: input audio buffer committed");const g=$(),f=H(g);A?A.appendChild(f):(n=document.querySelector("#received-text-container"))==null||n.appendChild(f),Ve();break;case"input_audio_buffer.speech_stopped":console.log("###### HandleRealtimeMessages: input audio buffer speech stopped");break;case"conversation.item.input_audio_transcription.completed":if(console.log("###### HandleRealtimeMessages: conversation.item.input_audio_transcription.completed:",s),A){A.textContent+="User: "+s.transcript;const m=document.createElement("p"),S=$(),z=H(S);m.appendChild(z),(r=A.parentNode)==null||r.insertBefore(m,A.nextSibling)}break;case"conversation.item.input_audio_transcription.failed":console.log("###### HandleRealtimeMessages: conversation.item.input_audio_transcription.failed:",s);break;case"response.done":if(console.log("###### HandleRealtimeMessages: response done"),e.length>0){const m=de(e),S=H(m);(i=document.querySelector("#received-text-container"))==null||i.appendChild(S)}(o=document.querySelector("#received-text-container"))==null||o.appendChild(document.createElement("hr")),p&&F&&(p=!1,F=!1,await v.close(),O(!1,R),E(w.ReadyToStart));break;default:c=JSON.stringify(s,null,2);break}c&&console.log(c),h&&clearTimeout(h),D=Date.now(),h=setTimeout(V,3e4),et()}O(!1,R)}function Ze(){const e=document.querySelector("#received-text-container");if(!e)return;const t={childList:!0,subtree:!0,characterData:!0};new MutationObserver(()=>{D=Date.now(),h&&clearTimeout(h),h=setTimeout(V,P()*1e3)}).observe(e,t),D=Date.now(),h=setTimeout(V,P()*1e3)}function V(){var e;Date.now()-D>=P()*1e3&&(console.log("No mutations for "+P()+" seconds. Stopping recording."),(e=document.querySelector("#stop-recording"))==null||e.click())}var X;(X=document.querySelector("#start-recording"))==null||X.addEventListener("click",async()=>{var i,o,s;const e=document.querySelector("#start-recording");e&&(e.classList.add("loading"),e.innerHTML='<i class="fas fa-spinner fa-spin"></i>'),E(w.Working);const t=(((i=document.querySelector("#endpoint"))==null?void 0:i.value)||"").trim(),n=(((o=document.querySelector("#api-key"))==null?void 0:o.value)||"").trim(),r=(((s=document.querySelector("#deployment-or-model"))==null?void 0:s.value)||"").trim();if(C()&&!t&&!r){alert("Endpoint and Deployment are required for Azure OpenAI"),B(e);return}if(!C()&&!r){alert("Model is required for OpenAI"),B(e);return}if(!n){alert("API Key is required"),B(e);return}q();try{await ve(t,n,r),ge(),e&&(e.classList.remove("loading"),e.innerHTML='<i class="fas fa-phone"></i>')}catch(c){console.log(c),E(w.ReadyToStart),B(e)}});function B(e){e&&(e.classList.remove("loading"),e.innerHTML='<i class="fas fa-phone"></i>')}var Z;(Z=document.querySelector("#stop-recording"))==null||Z.addEventListener("click",async()=>{const e=document.querySelector("#stop-recording");e&&(e.classList.add("loading"),e.textContent="Stopping..."),E(w.Working),O(!1,R),v.close(),E(w.ReadyToStart),G(!1),h&&(clearTimeout(h),h=null),b&&(clearTimeout(b),b=null),e&&(e.classList.remove("loading"),e.textContent="Stop");const t=document.querySelector("#start-recording");t&&(t.innerHTML='<i class="fas fa-phone"></i>');const n=document.querySelector("#received-text-container");n&&n.classList.remove("recording")});var ee;(ee=document.querySelector("#endpoint"))==null||ee.addEventListener("change",async()=>{le()});var te;(te=document.querySelector("#session-instructions"))==null||te.addEventListener("input",q);var ne;(ne=document.querySelector("#endpoint"))==null||ne.addEventListener("input",q);var re;(re=document.querySelector("#api-key"))==null||re.addEventListener("input",q);var oe;(oe=document.querySelector("#deployment-or-model"))==null||oe.addEventListener("input",q);var ie;(ie=document.querySelector("#auto-stop-time"))==null||ie.addEventListener("input",q);Ge();le();function ge(){const e=P();b&&clearTimeout(b),b=setTimeout(()=>{var t;console.log(`Auto-stopping after ${e} seconds of inactivity.`),(t=document.querySelector("#stop-recording"))==null||t.click()},e*1e3)}function P(){const e=document.querySelector("#auto-stop-time");return e?parseInt(e.value):30}function et(){b&&clearTimeout(b),ge()}async function tt(){var r,i,o;if(p)return;p=!0;const e=(((r=document.querySelector("#endpoint"))==null?void 0:r.value)||"").trim(),t=(((i=document.querySelector("#api-key"))==null?void 0:i.value)||"").trim(),n=(((o=document.querySelector("#deployment-or-model"))==null?void 0:o.value)||"").trim();if(C()&&!e&&!n){alert("Endpoint and Deployment are required for Azure OpenAI"),p=!1;return}if(!C()&&!n){alert("Model is required for OpenAI"),p=!1;return}if(!t){alert("API Key is required"),p=!1;return}q();try{await ve(e,t,n),await O(!0,R)}catch(s){console.log(s),p=!1;return}}async function Se(){if(!p)return;F=!0,G(!1);const e=Qe();e&&await v.send({type:"input_audio_buffer.append",audio:e}),await v.send({type:"input_audio_buffer.commit"})}var se;(se=document.querySelector("#one-time-talk"))==null||se.addEventListener("pointerdown",async e=>{e.preventDefault(),await tt()});var ae;(ae=document.querySelector("#one-time-talk"))==null||ae.addEventListener("pointerup",async e=>{e.preventDefault(),await Se()});var ce;(ce=document.querySelector("#one-time-talk"))==null||ce.addEventListener("pointerleave",async e=>{e.preventDefault(),p&&!F&&await Se()});function nt(){const e=document.querySelector("#voice-select");e&&localStorage.setItem("selectedVoice",e.value)}function rt(){const e=document.querySelector("#voice-select"),t=localStorage.getItem("selectedVoice");e&&t&&(e.value=t)}function ot(){const e=document.querySelector("#session-instructions");if(e){const t=ue();e.value=t}}document.addEventListener("DOMContentLoaded",()=>{rt(),Je(),Ye(),ot();const e=document.querySelector("#voice-select");e&&e.addEventListener("change",nt);const t=document.querySelector("#send-text"),n=document.querySelector("#text-input");t&&n&&t.addEventListener("click",()=>{const r=n.value.trim();r&&($e(r),n.value="")})});
